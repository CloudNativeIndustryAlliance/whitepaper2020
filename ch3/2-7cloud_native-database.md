---
authors: ["曹剑"]
company: ["百度云"]
reviewers: ["刘如明"]
---
# 7.	云原生数据库

Gartner在数据库市场分析报告中预测到2022年，75%的数据库将被部署或迁移至云平台，只有5%的数据库会考虑部署在本地。事实上，巨大的变革正在发生。在国外，以AWS为主的云厂商已实现云技术与数据库的融合，在逐步挑战与吞噬传统数据库厂商市场份额。在国内，云+数据库的发展也已到了下半场，数据库正在不断深度融合云计算的特性，为用户提供高弹性、分布式、低成本的极致使用体验。

回顾数据库的发展历程，大致可分为三个阶段：第一阶段是传统IT架构，基于物理机进行部署。业务部门采购时需为未来业务增量预留资源，存在着显著的资源浪费；而当业务快速增长时，资源的采购周期又无法满足业务快速扩张的需求。此外，传统IT架构下服务器故障恢复时间较长，对数据库影响明显。综上所述，传统IT架构下的数据库存在着高成本，低效率，稳定性差等诸多问题。

第二阶段是数据库上云。在这一架构下，厂商对外提供云数据库服务，基于云的弹性调度和虚机迁移等能力提高了数据库的弹性和稳定性。但受限于传统数据库技术能力限制，这一架构同样存在很多问题：随着业务量的极速增长，单台服务器无法存储几十、上百TB数据；同时云数据库系统的并发访问量相比传统架构有数量级的增长，导致数据同步延时严重，可用性降低。当前解决这些问题的方式主要有业务拆分及采用分库分表的分布式数据库架构两种方式，但以上两种方法同时会带来系统复杂度提高、扩展操作难度大的问题。

第三阶段是云原生数据库。这种数据库采用计算存储分离的架构，遵循“日志即数据”的原则，计算层能够自动实现读写分离，单集群可扩展到16个节点，同时具备秒级的扩缩容能力；存储层采用多租户分布式高可用存储系统，单集群一般可扩展到100TB以上。

总体来看，相对于传统数据库云原生数据库主要有以下几方面优势：
1）标准化：云原生数据库本身使用Kubernetes等云原生平台进行部署，以PaaS的形式对外提供服务，提供近似对象存储的使用体验。这使得数据库无论是在资源使用，还是应用部署，亦或是业务调用上都实现了标准化。
2）降低成本：与现有数据库架构不同，用户无需提前预留资源，仅需为使用的资源进行付费；受益于计算存储分离架构，增加从库时不会增加存储成本，仅需为计算资源付费。经对比发现，云原生架构数据库成本仅为传统商业数据库的1/10。
3）研发效率提升：云原生数据库一般兼容现有数据协议，业务无需修改即可进行迁移。同时数据库提供的100TB以上的空间可满足绝大部分应用需求，免去了分库分表所带来的数据一致性问题，研发仅需要关注业务逻辑即可。效率的提升可以帮助产品快速迭代，不断创新，从而迅速抢占市场。
4）稳定性：传统数据库稳定性严重依赖底层资源，当资源故障时需进行数据迁移，导致故障恢复时间过长。在云原生架构下，计算节点故障时无需拷贝数据，仅需创建新的资源承载流量即可，可做到秒级别的故障恢复。而存储节点一搬采用分布式多副本的架构，其故障更是对业务无感。

## 什么是云原生数据库？

要知道什么是云原生数据库，就要从数据库历史讲起。数据库系统的研究和开发从20世纪60年代中期开始到现在，几十年过去，经历三代演变，取得了十分辉煌的成就。造就了C.W. Bachman、E.F.Codd和J. Gray三位图灵奖得主。发展了以数据建模和数据库管理系统（DBMS）核心技术为主的一门学科。带动了一个巨大的软件产业。

数据库系统的萌芽出现于20世纪60年代。当时计算机开始广泛地应用于数据管理，对数据的共享提出了越来越高的要求。传统的文件系统已经不能满足人们的需要。能够统一管理和共享数据的数据库管理系统（DBMS）应运而生。数据模型是数据库系统的核心和基础，各种DBMS 软件都是基于某种数据模型的。所以通常也按照数据模型的特点将传统数据库系统分成网状数据库（Network database）、层次数据库（Hierarchical database）和关系数据库（Relational database）三类。

最早出现的是网状DBMS，是美国通用电气公司Bachman等人在1961年开发成功的IDS（IntegratedData Store）。1961年通用电气公司的CharlesBachman 成功地开发出世界上第一个网状DBMS也是第一个数据库管理系统——集成数据存储（IntegratedData Store，IDS），奠定了网状数据库的基础，并在当时得到了广泛的发行和应用。

网状数据库模型对于层次和非层次结构的事物都能比较自然的模拟，在关系数据库出现之前网状DBMS要比层次DBMS用得普遍。在数据库发展史上，网状数据库占有重要地位。层次型DBMS是紧随网络型数据库而出现的。最著名最典型的层次数据库系统是IBM 公司在1968 年开发的IMS（InformationManagement System），一种适合其主机的层次数据库。这是IBM公司研制的最早的大型数据库系统程序产品。

网状数据库和层次数据库已经很好地解决了数据的集中和共享问题，但是在数据独立性和抽象级别上仍有很大欠缺。1970年，IBM的研究员E.F.Codd博士在刊物《Communication of the ACM》上发表了一篇名为“A Relational Model of Data for Large Shared Data Banks”的论文，提出了关系模型的概念，奠定了关系模型的理论基础。这篇论文被普遍认为是数据库系统历史上具有划时代意义的里程碑。Codd的心愿是为数据库建立一个优美的数据模型。后来Codd又陆续发表多篇文章，论述了范式理论和衡量关系系统的12条标准，用数学理论奠定了关系数据库的基础。

关系模型有严格的数学基础，抽象级别比较高，而且简单清晰，便于理解和使用。但是当时也有人认为关系模型是理想化的数据模型，用来实现DBMS是不现实的，尤其担心关系数据库的性能难以接受，更有人视其为当时正在进行中的网状数据库规范化工作的严重威胁。为了促进对问题的理解，1974年ACM牵头组织了一次研讨会，会上开展了一场分别以Codd和Bachman为首的支持和反对关系数据库两派之间的辩论。这次著名的辩论推动了关系数据库的发展，使其最终成为现代数据库产品的主流。

1970年关系模型建立之后，IBM公司在San Jose实验室增加了更多的研究人员研究这个项目，这个项目就是著名的System R。其目标是论证一个全功能关系DBMS的可行性。该项目结束于1979年，完成了第一个实现SQL的DBMS。

同时，1973年加州大学伯克利分校的Michael Stonebraker和EugeneWong利用System R已发布的信息开发自己的关系数据库系统Ingres。他们开发的Ingres项目最后被Oracle公司、Ingres公司以及硅谷的其他厂商所商品化。后来，System R和Ingres系统双双获得ACM的1988年“软件系统奖”。1976年Honeywell（霍尼韦尔）公司开发了第一个商用关系数据库系统─MulticsRelational Data Store（MRDS）。关系型数据库系统以关系代数为坚实的理论基础，经过几十年的发展和实际应用，技术越来越成熟和完善。其代表产品有MySQL、Oracle、DB2、SQLServer等。

**SQL**

SQL是关系型数据库管理系统（RDBMS），顾名思义，它是围绕关系代数和元组关系演算构建的。 70年代以来，它一直是主要的数据库解决方案，只是最近才有了其他产品的空间。 不管有些人说什么，这意味着它能出色地执行广泛的任务。 其主要优点如下：
* 不同的角色（开发者，用户，数据库管理员）使用相同的语言。
* 不同的RDBMS使用统一标准的语言。
* SQL使用一种高级的非结构化查询语言。
* 它坚持ACID准则(原子性，一致性，隔离性，持久性)，保证了每个事务的稳定性和安全性。

SQL的好处来源于它的统一性，舒适性和易用性，即使你只有非常有限的SQL知识。然而，它的缺点使得它非常不适合某些类型的项目。SQL的主要问题是它难以扩展，因为多是B+树为底层，所以性能随着数据库的变大而快速下降。分布式也有问题。

NoSQL和NewSQL出现的原因之一，正是以前的RDBMS的设计不能满足现代数据库每秒处理的事务数量。像亚马逊或阿里巴巴等需要处理惊人数据量的巨头，以前的RDBMS会在几分钟内出现问题。

**NoSQL(Not Only SQL)**

NoSQL越来越受欢迎，其中重要的实现是Redis， MongoDB，Cassandra等产品。它主要用于解决SQL的可扩展性问题。因此，它没有架构，并且建立在分布式系统上，这使得它易于扩展和分片。

然而，这些好处是以放宽ACID原则为代价的：NoSQL采取最终一致性原则，而不是所有四个参数在每个事务中保持一致。 这意味着如果在特定时间段内没有特定数据项的更新，则最终对其所有的访问都将返回最后更新的值。 这就是这样的系统通常被描述为提供基本保证的原因（基本可用，软状态，最终一致性）— 而不是ACID。

虽然这个方案极大地增加了可用时间和伸缩性，它也会导致数据丢失----这个问题的严重程度取决于数据库服务器的支持情况和应用代码质量。在某些情况下，这个问题十分严重。

另一个NoSQL出现的问题是现在有很多类型的NoSQL系统，但它们之间却几乎没有一致性。诸如灵活性，性能，复杂性，伸缩性等等特性在不同系统间差别巨大，这使得甚至是专家在他们之间都很难选择。不过，当你根据项目特点作出了合适的选择，NoSQL可以在不显著丢失稳定性的情况下提供一个远比SQL系统更高效的解决方案。

**NewSQL(云原生数据库)**

NewSQL是一种相对较新的形式，旨在使用现有的编程语言和以前不可用的技术来结合SQL和NoSQL中最好的部分。NewSQL目标是将SQL的ACID保证与NoSQL的可扩展性和高性能相结合NewSQL=SQL + NoSQL。

## 云原生数据库代表
**1.Spanner**  
  Spanner 是一个可扩展的、全球分布式的数据库，是在谷歌公司设计、开发和部署的。在最高抽象层面，Spanner 就是一个数据库，把数据分片存储在许多 Paxos状态机上，这些机器位于遍布全球的数据中心内。复制技术可以用来服务于全球可用性和地理局部性。客户端会自动在副本之间进行失败恢复。随着数据的变化和服务器的变化，Spanner 会自动把数据进行重新分片，从而有效应对负载变化和处理失败。Spanner 被设计成可以扩展到几百万个机器节点，跨越成百上千个数据中心，具备几万亿数据库行的规模。

  应用可以借助于 Spanner 来实现高可用性，通过在一个洲的内部和跨越不同的洲之间复制数据，保证即使面对大范围的自然灾害时数据依然可用。我们最初的客户是F1，一个谷歌广告后台的重新编程实现。F1 使用了跨越美国的 5 个副本。绝大多数其他应用很可能会在属于同一个地理范围内的 3-5 个数据中心内放置数据副本，采用相对独立的失败模式。也就是说，许多应用都会首先选择低延迟，而不是高可用性，只要系统能够从 1-2 个数据中心失败中恢复过来。

**2.TiDB**  
  开源分布式NewSQL关系型数据库TiDB是国产新一代开源分布式NewSQL数据库，模型受Google Spanner/F1论文的启发，由Go和Rust语言实现，实现了自动的水平伸缩，强一致性的分布式事务，基于Raft算法的多副本复制等重要NewSQL特性。TiDB结合了RDBMS和NoSQL的优点，部署简单，在线弹性扩容和异步表结构变更不影响业务，真正的异地多活及自动故障恢复保障数据安全，同时兼容MySQL协议，使迁移使用成本降到极低。

  TiDB是MySQL兼容的，水平弹性扩展，分布式事务，跨数据中心数据强一致性保证，故障自恢复的高可用，海量数据高并发实时写入与实时查询（HTAP混合负载），TiDB的设计目标是100%的OLTP场景和80%的OLAP场景，更复杂的OLAP分析可以通过TiSpark项目来完成。

**3.PolarDB**  
  PolarDB是阿里巴巴自研究的云原生数据库。PolarDB对计算和存储引擎进行优化，通过标准Sysbench OLTP性能基准测试，读性能最高达到100万QPS，写性能最高超过25万QPS，轻松应对企业级大规模数据的处理。最大支持16个处理节点，系统并发聚合读性能最高达到1000万QPS。另外，POLARDB针对数据的复杂查询能力，提供加速模块，能够获得高达4-20倍左右的查询加速能力。

  PolarDB采用分布式共享存储架构，计算与存储分离，采用最先进的3D Xpoints存储介质，存储空间根据用户实际使用数据自动扩展，存储按照用户的实际使用量收费，。无论多大数据量，5分钟之内即可完成节点规格的升级和进行只读节点的扩展，应需而变，随需所用，极速适配。

  100%兼容MySQL在线事务处理的能力，向下兼容MySQL5.6，极大的降低用户业务的适配成本，使企业上云的适配成本和改造风险降到最低。

  PolarDB使用分布式海量存储系统，通过多个副本带来数据的高可靠性。底层的存储数据支持Snapshot进行秒级别的极速备份。并且支持数据强一致的同城灾备能力，为企业级最核心的价值数据提供最可靠的技术支撑。

**4.TDSQL**  
   TDSQL是腾讯打造的一款分布式数据库产品，具备强一致高可用、全球部署架构、分布式水平扩展、高性能、企业级安全等特性，同时提供智能 DBA、自动化运营、监控告警等配套设施，为用户提供完整的分布式数据库解决方案。特点：

* 自动水平拆分
* 高度兼容 MySQL 语法
* 领先的分布式架构
* 不停机弹性扩展
* 强同步复制
* 超高性能
* 易于使用的托管部署
* 支持 JSON
* 支持 RocksDB


**5.UDDB**  
   UCloud分布式数据库（UCloud Distributed Database，简称UDDB）是一种稳定、可靠、容量和服务能力可弹性伸缩的分布式关系型数据库服务。UDDB高度兼容MYSQL协议和语法，支持垂直建表、自动化水平拆分，在线平滑扩缩容，服务能力线性扩展，透明读写分离，具备数据库全生命周期运维管控能力。特点：

* 简单易用
* 业务访问
* 快速部署
* 弹性扩展
* 低成本
* 高可用
* 在线数据迁移


**6.RadonDB**  
  RadonDB定位是新一代分布式关系型数据库，基于MySQL研发。特性：  

* 可扩展，用户只需用鼠标点击两下，就可以增加更多的节点，获得更大的容量和更高的性能，它的扩展是线性的;
* 第二，高可用，RadonDB上层的SQL节点和下层的存储节点都是分布式的，且完全无中心化，不会出现单点故障，当副本出现问题的时候，可以秒级自动切换，无需人工干预;
* 第三，强一致，RadonDB具备分布式事务的能力，意味着可以满足金融客户的需求，虽然是分布式数据库，依然可以保证其强一致性;
* 第四，易部署，因为没有中心化，所以很容易跟云平台相结合，也可以独立部署;
* 第五，MyNewSQL，从MySQL到NoSQL，然后到现在比较流行的NewSQL，而青云现在已经走到了MyNewSQL这条道路上，就是MySQL和NewSQL相结合，充分发挥两者的优势。


**7.CockroachDB**  
  CockroachDB是构建于事务处理及强一致性KV存储上的分布式SQL数据库，支持水平扩展、自动容错处理、强一致性事务，并且提供SQL接口用于数据处理，是Google Spanner/F1的开源实现。 CockroachDB适用于应用对数据要求精确、可靠、完全正确的场景，支持自动复制、均匀分布、基于极小配置的数据恢复，可用于分布式的、可复制的联机事务处理（OLTP），多数据中心的部署，私有云的基础构建，它不适用于读少写多的场景，可以用内存数据库来代替，也不适用于复杂的join查询，重量级的数据分析及联机分析处理（OLAP）。支持PostgreSQL，对标准SQL支持较完善，较稳定
